-# get Rails locales (copied from http://stackoverflow.com/a/10610347/1796645). Complicated Name to avoid possible conflicts with other gems
:javascript
  window.I18nForAttachments = #{(current_translations.to_json.html_safe)};
- attach_limit_size = Setting.attachment_size || 2.megabytes
- edit = !f.object.new_record?
- collapsed = session[:entity_extra].nil?
- entity.attachments.build

= subtitle :entity_extra, collapsed, t(:extra_doc)

.section
  #entity_extra{ hidden_if(collapsed) }
    %ul{class: edit ? 'edit_form' : '', 'attach_limit' => attach_limit_size }
      = f.simple_fields_for :attachments do |t|
        %li.attach_div
          - old_record = !t.object.new_record?
          -# file input field needs to exist to enable uploading of other attachments. But it is hidden to disable update acction
          = t.file_field 'attachment', class: 'attach', style: ('display:none;' if old_record)
          %span.current_file_info
            - if old_record
              %span.current_file_name= t.object.try(:attachment_file_name)
              %span -
              %i= t.object.try :description
              %span.file_size
                = "(#{number_to_human_size(t.object.try(:attachment_file_size))})"
            %span.file_size
          = t.text_field :description, class: 'file-description', placeholder: t('description', default: 'Description').upcase, style: 'display: none;'
          %span.remove_link{class: old_record ? 'display_remove'  : ''}= link_to t('delete', default: 'Remove'), '#', data: old_record ? { confirm: 'Are you sure want to delete this attachment?' } : {}

      .next_attachment
