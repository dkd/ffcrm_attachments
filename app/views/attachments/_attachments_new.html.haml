- attach_limit_size = Setting.attachment_size || 2.megabytes
- edit = !f.object.new_record?
- collapsed = session[:entity_extra].nil?
- entity.attachments.build

= subtitle :entity_extra, collapsed, t(:extra_doc)

.section
  #entity_extra{ hidden_if(collapsed) }
    %ul{class: edit ? 'edit_form' : '', 'attach_limit' => attach_limit_size }
      = f.simple_fields_for :attachments do |t|
        %li.attach_div
          - new_record = t.object.new_record?
          = t.file_field 'attachment', class: 'attach'
          %span.current_file_info
            %span.current_file_name= t.object.try(:attachment_file_name)
            - unless new_record
              %span.file_size
                = "(#{number_to_human_size(t.object.try(:attachment_file_size))})"
          %span.remove_link{class: new_record ? '' : 'display_remove'}= link_to t('delete', default: 'remove'), '#', data: new_record ? {} : { confirm: 'Are you sure want to delete this attachment?' }

      .next_attachment
